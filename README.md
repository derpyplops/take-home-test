# Havana Take-Home Test

This repository consists of a simplified version of our production code-base.

Spend about 30 minutes understanding the structure of the code, then answer the questions below. Feel free to make any assumptions you deem necessary, as long as you document them clearly. 

The take-home test itself consists of three parts, with recommended time to spend on each:
1. Code Review (30 minutes)
2. Planning (1 hour)
3. Implementation (2 hours)

# Overview of code

This code covers the part of our app which classifies phone calls based on intent, so that we can execute the appropriate follow-up actions afterwards.

## Architecture

Our app consists of:
* A Postgres database - the database schema can be found in `db/migrations`
* A Golang backend API server - the entrypoint for this is in `cmd/backend/main.go`

The frontend is not included for this take-home test.

## Tooling

* [sqlc](https://github.com/sqlc-dev/sqlc/) - generates type-safe functions from SQL queries (in `queries.sql` files).
* [migrate](https://github.com/golang-migrate/migrate) - used for database migrations.

## Data schema

* A `CampaignThread` represents the state of a conversation between our agent and a lead. This normally contains other data such as emails or text messages, but for the purposes of this test, assume it primarily contains only voice calls.
* A `VoiceCall` represents a single call to a lead, which is part of a `CampaignThread`.
* A `Classification` represents the results of running our intent classifier on a `CampaignThread`.

## Package structure

Most of the relevant code is in the `pkg/` directory. Subpackages are:

* `common/` - base data structures
* `db/` - functions and helpers for database access
* `svc/` - contains `svc.Env`, which contains key services
* `classifications/` - `Classification` related code
* `campaignthreads/` - `CampaignThread` related code
* `voiceclassifier/` - code for classifying intent of voice calls.
* `api/` - routes and handlers for the API server

Sub-sub-packages called `generated/` are generated by `sqlc` from the SQL queries in `queries.sql`.

## Classification intent definitions

Once the classifier has generated an intent for the voice call, we will take follow-up actions based on the intent (code not included in this repository).

Listed below are the approximate definitions and follow-up actions for each intent.

* `voice_interested`: The lead is interested in continuing with their enrollment, they will be put in contact with a human rep by email. Optionally, we may book an appointment with the human rep for them.
* `voice_not_interested`: The lead is not interested in the course. They will be marked as such so that human reps will not contact them in the future.
* `voice_immediate_hangup`: The lead hung up the phone without a conclusive classification. They will be sent an email asking about their interest.
* `voice_wrong_number`: The lead's phone number is wrong. We will continue attempting to reach out using non-voice-call methods.
* `voice_no_action`: The lead may still be interested, but no follow-up action needs to be taken (e.g. they are already in contact with the advisor).
* `voice_wants_call_back`: We will schedule another AI call with the lead.
* `voice_wants_email_follow_up`: The lead may still be interested, but requested to continue the conversation via email. They will be sent an email with more information and asking again about their interest.
* `voice_wants_whatsapp_sms_follow_up`: The lead may still be interested, but requested to continue the conversation via SMS or WhatsApp. They will be sent a message with more information and asking again about their interest.
* `voice_voice_mail`: The lead didn't pick up the phone and the call was with a voice mailbox. We will continue attempting to reach out.
* `voice_unknown`: None of the above. The conversation will be escalated to us to manually decide what to do next.

# Part 1 - Code Review

The purpose of this part is to demonstrate your ability to evaluate code quality.

In the `zhan-classifier-service` branch, you are provided a LLM-generated change, which is supposed to: implement a service that takes `CampaignThread`s with the correct status, classifies the latest voice call in each one, and writes the results back to the database.

Review the code, and sketch out what changes you would make before you would feel comfortable merging the code to production.

# Part 2 - Planning

The purpose of this part is to demonstrate your ability to think through a problem and justify your proposed solution.

If you join us, one of your first projects would be to improve the voice call intent classifier. `pkg/voiceclassifier/voiceclassifier.go` contains an old and simplified version of our classifier, but for the purposes of this test, assume it is representative of our latest version. You are also provided a dataset in `data/dataset.csv` - this contains sample voice calls with both human-generated intent classifications and the intent predicted by the classifier (don't take the human-generated ones as ground-truth, but rather as a starting point).

As described above, we are deterministically executing follow-up actions based on the intent classification. Also, imagine we are reviewing 100% of the follow-up actions manually before executing them. We want to make improvements to reduce this manual review workload.

How would you ensure that the quality of the classified intents are high, while keeping the percentage of manually-reviewed follow-up actions low?

Sketch out a plan for how you would improve this over the next 4 weeks. Feel free to propose as radical changes as necessary, as long as you believe you can deliver them within 4 weeks.

# Part 3 - Implementation

The purpose of this part is to demonstrate your general ability to produce production-quality code.

Carve out any part of your plan which can be implemented in 1-2 hours, and implement it. You may use any language you feel comfortable in for this part - approximate the necessary types or data structures as necessary.
